# TCP/IP 网络分层有那几层？
同一台设备上的进程间通信，有很多种方式，比如有管道、消息队列、共享内存、信号等方式，而对于不同设备上的进程间通信，就需要网络通信，而设备是多样性的，所以要兼容多种多样的设备，就协商出了一套通用的网络协议。每一层有各自的作用和职责，协议是水平的、服务是垂直的。
- 应用层：应用进程的交互
- 传输层：两台主机进程通信提供传输服务，tcp报文段和用户数据报
- 网络层：分组在多个网络的路由转发，包
- 数据链路层：分组在一个网络上的传输，桢
- 物理层：比特流传输，比特流

# TCP和UDP的区别
|TCP|UDP|
|----|----|
|面向连接的可靠传输|无连接的不可靠|
|可靠传输：无差错、不丢失、不重复，文件传输|尽最大努力交付，视频会议|
|一对一|一对多、多对多|
|面向字节流|面向报文|
|首部开销20字节|8字节|
# 三次握手过程？
- 刚开始客户端处于close,服务端处于listen
- 第一次握手，客户端向服务端发送SYN报文，指明客户端的序列号seq=x,客户端处于SYN_SEND状态
- 第二次握手，服务端受到SYN后，向客户端发送ack=x+1报文、指明了序列号seq=y，服务端进入SYN_RCVD状态
- 第三次握手，客户端受到SYN报文后，向服务端发送ack=y+1确认报文,表明收到来自服务端的报文，客户端处于建立连接状态，服务端收到ack后也会处于建立连接状态
# 四次挥手过程？
- 刚开始客户端和服务端都处于连接已建立的状态
- 第一次挥手, 客户端发送一个 FIN 报文，发出连接释放报文段（FIN=1，序号seq=u），并停止再发送数据，主动关闭TCP连接，进入FIN_WAIT1（终止等待1）状态，等待服务端的确认;
- 第二次挥手,服务端收到连接释放报文段后即发出确认报文段（ACK=1，确认号ack=u+1，序号seq=v），服务端进入CLOSE_WAIT（关闭等待）状态，此时的TCP处于半关闭状态，客户端到服务端的连接释放。客户端收到服务端的确认后，进入FIN_WAIT2（终止等待2）状态，等待服务端发出的连接释放报文段。
- 第三次挥手,服务端没有要向客户端发出的数据，服务端发出连接释放报文段（FIN=1，ACK=1，序号seq=w，确认号ack=u+1），服务端进入LAST_ACK（最后确认）状态，等待客户端的确认。
- 第四次挥手, 客户端收到服务端的连接释放报文段后，对此发出确认报文段（ACK=1，seq=u+1，ack=w+1），客户端进入TIME_WAIT（时间等待）状态。此时TCP未释放掉，需要经过时间等待计时器设置的时间2MSL后，客户端才进入CLOSED状态。
# TCP 如何保证可靠传输
- 通信前建立连接：确保双方具有发送和接受能力
- 确认和重传机制：接收方收到报文就会确认，发送方发送一段时间后没有收到确认就会重传
- 数据校验：TCP头部有校验和，校验报文是否损坏
- 序号机制（序号、确认号）：确保了数据是按序、完整到达。
- 流量控制和拥塞避免
# TCP的封包和拆包？
TCP是无边界的流传输，所以需要对TCP进行封包和拆包，确保发送和接收的数据不粘连。
- 封包：发送数据报的时候为每个TCP数据包加上一个包头，将数据报分为包头和包体两个部分。包头是一个固定长度的结构体，里面包含该数据包的总长度。
- 拆包：接收方在接收到报文后提取包头中的长度信息进行截取
# TCP的流量控制
为了控制发送方发送速率，保证接收方来得及接收。TCP 利用滑动窗口实现流量控制，滑动窗口的大小意味着接收方还有多大的缓冲区可以用于接收数据。发送方可以通过滑动窗口的大小来确定应该发送多少字节的数据。当滑动窗口为 0 时，发送方一般不能再发送数据报
# TCP的拥塞避免
- 拥塞控制目的是防止数据过多注入到网络中导致网络资源（路由器、交换机等）过载
- 慢开始：为了探测网络的拥塞程度，即由小到大逐渐增大发送窗口，也就是由小到大逐渐增大拥塞窗口数值。cwnd 初始值为 1，每经过一个传播轮次，cwnd 加倍，直到达到阀值ssthresh；
- 拥塞避免：让拥塞窗口 cwnd 缓慢地增大，即每经过一个往返时间 RTT 就把发送方的拥塞窗口 cwnd 加1，而不是加倍。这样，拥塞窗口 cwnd 按线性规律缓慢增长
- 快重传：快重传就是让发送方尽快开始重传，而不是等待超时重传计时器超时再重传
- 快恢复：发送端收到了三个重复确认，就知道现在只是丢失了个别报文段，启动快恢复算法。发送方将慢开始门限ssthresh值和拥塞窗口cwnd值调整为当前窗口的一半；开始执行拥塞避免算法
- 总之，TCP的拥塞避免机制通过动态调整发送速率和拥塞窗口的大小来管理网络拥塞，以确保网络的稳定性和性能。这些机制有助于避免网络拥塞和数据包丢失，从而提高了TCP连接的可靠性和效率。

